\documentclass[aspectratio=43]{beamer}
% Metropolis Theme ------------------------------------------------------------------------------
\usetheme{metropolis} % Use metropolis theme


% Title ------------------------------------------------------------------------------
\title{Difference-in-Differences with Spatial Spillover}
\date{\today}
\author{Kyle Butts}
% \institue{}

\input{preamble.tex}

\addbibresource{references.bib}

\usepackage{adjustbox}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{threeparttable}

% ------------------------------------------------------------------------------
\begin{document}

% ------------------------------------------------------------------------------
\maketitle
% ------------------------------------------------------------------------------

\begin{frame}{Spatial Spillovers}
    Researchers aim to estimate the average treatment effect on the treated: 
    \[
        \tau \equiv \mathbb{E} \left[ Y_{i1}(1) - Y_{i1}(0) \ \vert \ D_{i} = 1 \right]
    \]
    
    \vspace{5mm}
    Spillover effects are when effect of treatment extend over boundaries such as states, counties, etc.
    
    \begin{itemize}
        \item e.g. large employer opening/closing in a county have positive employment effects on nearby counties
    \end{itemize}
\end{frame}


\begin{frame}{Bias from Spatial Spillovers}
    The canonical difference-in-differences estimate is: 
    \[ 
        \hat{\tau} = \underbrace{\hat{\mathbb{E}} \left[ Y_{i1} - Y_{i0} \mid D_i = 1 \right]}_{\text{Counterfactual Trend} \ + \ \tau} - 
        \underbrace{\hat{\mathbb{E}} \left[ Y_{i1} - Y_{i0} \mid D_i = 0 \right]}_{\text{Counterfactual Trend}}
    \]

    Two problems in presence of spillover effects: 
    \begin{itemize}
        \item \textbf{Spillover onto Control Units:} 
        
        Nearby ``control'' units fail to estimate counterfactual trends because they are affected by treatment
        
        \vspace{2.5mm}
        \item \textbf{Spillover onto other Treated Units:} 
        
        Treated units are also affected by nearby units and therefore combines ``direct'' effects with spillover effects
    \end{itemize}

\end{frame}

% Just TE
\imageframe{../../figures/figure-map_te.png}

% TE + Spill Control
\imageframe{../../figures/figure-map_te_spill_control.png}

% TE + Spill Control + Spill Treat
\imageframe{../../figures/figure-map_te_spill_all.png}


\begin{frame}{Outline}

    \begin{itemize}
        \item[1--] Using a potential outcomes framework, I decompose the difference-in-differences estimator in to three parts:
        \begin{itemize}
            \item Direct Effect of Treatment
            \item Spillover onto Treated Units
            \item Spillover onto Control Units
        \end{itemize} 
        
        \item[2--] Using Monte Carlo simulations:
        \begin{itemize}
            \item Show when biases are relatively large
            \item Analyze effectiveness of current adjustments done by applied researchers 
        \end{itemize}  

        \item[3--] Revisit \citet{Kline_Moretti_2014} analysis of the Tennessee Valley Authority
    \end{itemize} 
\end{frame}

% @TODO: Literature Review
\begin{frame}{Contribution}

    
    
    \underline{Difference-in-Differences Estimation with Spillovers} 
    
    \begin{citecolor}
        [\citet{Clarke_2017}, \citet{Berg_Streitz_2019}, and \citet{Verbitsky-Savitz_Raudenbush_2012}]
    \end{citecolor}
    
    % \begin{itemize}
    %     \item My derivation generalizes the above papers by being in the form of potential outcomes.
    % \end{itemize}

    \underline{Potential Outcome Framework for Spillovers}
    
    \begin{citecolor}
        [\citet{Vazquez-Bare_2019}, \citet{Angelucci_DiMaro_2016}, \citet{Angrist_2014}]        
    \end{citecolor}


    \underline{Place-based Policies}

    \begin{citecolor}
        [\citet{Kline_Moretti_2014b} and \citet{Kline_Moretti_2014}]
    \end{citecolor}

    % \begin{itemize}
    %     \item I highlight the need to control for spillovers to properly estimate local effects of policies.
    % \end{itemize}
\end{frame}


% ------------------------------------------------------------------------------
\section{Theory}
% ------------------------------------------------------------------------------

\begin{frame}{Potential Outcomes Framework}
    For exposition, I will label units as counties. Assume all treatment occurs at the same time (2-periods or pre-post averages).\footnote{This form adapts the framework of \citet{Vazquez-Bare_2019} for the diff-in-diff setting.}
    
    \begin{itemize}
        \item Let $Y_{it}(D_i, h_i(\vec{D}))$ be the potential outcome of county $i \in \{ 1, \dots, N \}$ at time $t$ with treatment status $D_i \in \{0, 1\}$.
        
        \item $\vec{D} \in \{0,1\}^N$ is the vector of all units treatments.
        
        \item The function $h_i(\vec{D})$ maps the entire treatment vector into a scalar that completely determines the spillover. 
        
        \item In the world with no treatment, $\vec{0}$, we say $h_i(\vec{0}) = 0$.
    \end{itemize}
\end{frame}

\begin{frame}{Examples of $h_i(\vec{D})$}
    
    Examples of $h_i(\vec{D})$:
    
    \begin{itemize}
        \item \textbf{Treatment within $x$ miles:}
        
        $h_i(\vec{D})$ equals 1 if there is a treated unit within $x$-miles of unit $i$ and equals 0 otherwise
            
        \vspace{2.5mm}
        \item \textbf{Average treatment among $k$-nearest neighbors:}
        
        $h_i(\vec{D}) = \sum_{j = 1}^k D_{n(i,j)} / k$ where $n(i,j)$ represents the j-th closest neighbor to unit $i$. 


    \end{itemize}
\end{frame}

\begin{frame}{Estimand of Interest}
    Estimand of Interest: \[ 
        \textcolor{green}{\tau_{\text{direct}}} \equiv \textcolor{green}{\mathbb{E}\left[ Y_{i,1}(1, 0) - Y_{i,1}(0, 0) \mid D_i = 1\right]}
    \]

    This is the direct effect in the absense of spillovers.
\end{frame}

\begin{frame}{Parallel Trends}
    I assume a modified version of the parallel trends assumption: 
    \[
        \mathbb{E}\left[ Y_{i,1}(0, 0) - Y_{i,0}(0, 0) \mid D_i = 1, \vec{D} = 0 \right] 
    \] \[
        \quad =
        \mathbb{E}\left[ Y_{i,1}(0, 0) - Y_{i,0}(0, 0) \mid D_i = 0, \vec{D} = 0 \right],
    \]

    \vspace{5mm}
    In the complete absence of treatment (not just the absence of individual $i$'s treatment), the change in potential outcomes from period 0 to 1 would not depend on treatment status
    
\end{frame}

\begin{frame}{What does Diff-in-Diff identify?}
    With the parallel trends assumption and random assignment of $D_i$, I decompose the diff-in-diff estimate as follows: 
        
    \begin{align*}
        &\mathbb{E} \left[ Y_{i1} - Y_{i0} \mid D_i = 1 \right] - \mathbb{E} \left[ Y_{i1} - Y_{i0} \mid D_i = 0 \right] \\
        &\quad = 
        \textcolor{green}{\mathbb{E} \left[ Y_{i1}(1, 0) - Y_{i1}(0, 0) \mid D_i = 1 \right]} \\
        &\quad\quad + 
        \textcolor{red}{\mathbb{E} \left[ Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, 0) \mid D_i = 1 \right]} \\ 
        &\quad\quad - 
        \textcolor{purple}{\mathbb{E} \left[ Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, 0) \mid D_i = 0 \right]} \\
        &\quad \equiv \textcolor{green}{\tau_{\text{direct}}} + \textcolor{red}{\tau_{\text{spillover, treated}}} - \textcolor{purple}{\tau_{\text{spillover, control}}}
    \end{align*}

\end{frame}

\begin{frame}{Biased Estimate for $\tau_{\text{direct}}$}
    \[ 
        \mathbb{E}[\hat{\tau}_{\text{diff-in-diff}}] - \textcolor{green}{\tau_{\text{direct}}} = \textcolor{red}{\tau_{\text{spillover, treated}}} - \textcolor{purple}{\tau_{\text{spillover, control}}}    
    \]

    \begin{table}
        \caption{Bias from Spillovers}
        \begin{tabular}{|l|cc|}
            \hline
            & + Spillover & - Spillover \\ \hline
            onto Treated & + Bias & - Bias \\
            onto Control & - Bias & + Bias \\
            \hline
        \end{tabular}
    \end{table}
\end{frame}

\begin{frame}{Example of Bias}
    \textbf{Treated Spillover:}
    
    $Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, 0) = -0.5$ if county $i$ shares a border with a treated county and $0$ otherwise.
        
    \textbf{Control Spillover:}
    
    $Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, 0) = 1$ if county $i$ shares a border with a treated county and $0$ otherwise.
        
    Then, the bias term is 
    \begin{align*}
        &-0.5 * \text{\% of treated counties sharing a border with a treated county} \\
        &-1 * \text{\% of treated counties sharing a border with a treated county}
    \end{align*}
\end{frame}

\begin{frame}{Partial Identification}
    Researchers can use the above method to create bounds for the biases resulting from spillovers. The choices should follow from the empirical context at hand.

    To formalize this, I follow the literature on partial identification for treatment effects
    \begin{citecolor}
        [\citet{Armstrong_Koles√°r_2020}, \citet{Rambachan_Roth_2020}, and \citet{Manski_Pepper_2018}]
    \end{citecolor}
\end{frame}

\begin{frame}{Partially-identified Set}
    Following \citet{Rambachan_Roth_2020} and \citet{Manski_Pepper_2018}, researchers can provide bounds to the maximum spillovers. 

    Let $\Delta$ denote the interval of potential biases: 
    \begin{align*}
        \Delta &\equiv [\underline{\Delta}, \overline{\Delta}] \\
        &= \left[ \min \tau_{\text{spill,treated}} - \tau_{\text{spill,control}}, \ \max \tau_{\text{spill,treated}} - \tau_{\text{spill,control}} \right] 
    \end{align*}

    The partially identified set is formed by \[ 
        \left[\hat{\tau} - \underline{\Delta} , \ \hat{\tau} + \overline{\Delta} \right]    
    \]

\end{frame}

\begin{frame}{Bias-adjusted Inference}

    Inference can be done following \citet{Rambachan_Roth_2020} by creating a Fixed-Length Confidence Interval: 
    \[ 
        \left[
            \hat{\tau} - \underline{\Delta} - z_{1 - \alpha/2} \text{SE}_{\hat{\tau}}, \ \hat{\tau} + \overline{\Delta} + z_{1 - \alpha/2} \text{SE}_{\hat{\tau}}
        \right]
    \]

    These standard errors should account for the spatial structure of outcomes following \citet{Conley_1999}.
\end{frame}




% ------------------------------------------------------------------------------
\section{Simulations}
% ------------------------------------------------------------------------------


\begin{frame}{Monte Carlo Simulations}
    \begin{itemize}
        \item Simulated the following Data Generating Process \begin{align*}
            y_{it} &= -2 + \mu_t + \mu_i + \tau_{\text{direct}} D_{it} + \tau_{\text{spillover, control}} (1-D_{it}) \text{Near}_{it} \\ 
            &\quad + \tau_{\text{spillover, treated}} D_{it} \text{Near}_{it} + \varepsilon_{it}
        \end{align*}

        \item Observation $i$ is a U.S. county, year $t \in \{2000, \dots, 2019\}$, treatment $D_{it}$ turns on in 2010 and is assigned randomly or through a spatial process.
        
        \item $\text{Near}_{it}$ is an indicator for having your county centroid be within 40 miles of a treated unit. 
        
        \item $\tau_{\text{direct}} = 2$, $\tau_{\text{spillover, control}} = 1$ and $\tau_{\text{spillover, treat}} = -0.5$.
    \end{itemize}
\end{frame}

\begin{frame}{Source of Bias 1: Control Units}
    Simulation 1: 
    
    \begin{itemize}
        \item The first simulation changes the probability of treatment, $D_{it}$.
        
        \item Assume, for now, there is only spillover on the control, i.e. $\tau_{\text{spillover,treat}} = 0$.
        
        \item Estimate the following equation: \[ 
            y_{it} = \alpha + \mu_t + \mu_i + \tau D_{it} + \epsilon_{it}    
        \]
        
        \item The bias of our estimate is \textit{Bias} $= \hat{\tau} - 2$
    \end{itemize}


    
\end{frame}

\imageframe{../../figures/figure-bias_from_prob_treat_slides.png}


\begin{frame}{Solution: Removing ``contaminated'' controls}
    A common solution to the problem of spillover is to restimate without neighboring control units and see what happens to the bias.

    This simulation assumes the correct ``contaminated'' control units, i.e. only control units with $h_i(\vec{D}) \neq 0$, which is not possible for researchers.
\end{frame}

\imageframe{../../figures/figure-bias_fix_slides.png}


\begin{frame}{Source of Bias 2: Treated Units}
    Simulation 2:

    \begin{itemize}
        \item I now add in the bias from spillover of treated units on to other treated units.
        
        \item This source of bias only occurs when treated units are located next to eachother, so the magnitude of bias depends on spatial autocorrelation of $D_{it}$. 
        
        \item Using a method from geosciences, I generate correlated ``fields'' across the US. 
        
        \item Then, for the counties in the top 10\% of values (hot spots in the field), I increase the probability of treatment. 
        
        \item The unconditional probability remains fixed at 10\%.
    \end{itemize}
\end{frame}

\imageframe{../../figures/figure-krig_slides.png}

\imageframe{../../figures/figure-spcorr_high_map_te_spill_all.png}

\imageframe{../../figures/figure-spcorr_low_map_te_spill_all}

\imageframe{../../figures/figure-bias_from_spatial_autocorr_slides.png}

\imageframe{../../figures/figure-bias_fix_spatial_autocorr_slides.png}


% ------------------------------------------------------------------------------
% \section{Estimation with Spillovers}
% ------------------------------------------------------------------------------

\begin{frame}{Spillovers as estimand of interest}
    Until now, we assumed our estimand of interest is $\textcolor{green}{\tau_{\text{direct}}}$.
    
    However, the two other spillover effects are of interest as well:
    \begin{itemize}
        \item $\textcolor{purple}{\tau_{\text{spillover, control}}}$: Do the benefits of a treated county come at a cost to neighbor counties? 
        
        \item $\textcolor{red}{\tau_{\text{spillover, treated}}}$: Does the estimated effect change based on others treatment? (This is what you should consider if you are a policy maker)
    \end{itemize}
    
    To estimate the spillover effects, we have to parameterize $h_i(\vec{D})$ function and the potential outcomes function $Y_i(D_i, h_i(\vec{D}))$.
\end{frame}

% @kylebutts @TODO: show parametrization fixes biases.

% \begin{frame}{Including Spillovers in Regression}
%    How well does the modified specification do with misspecified spillovers?
% \end{frame}




% ------------------------------------------------------------------------------
\section{Application: Tennessee Valley Authority}
% ------------------------------------------------------------------------------

\begin{frame}{Tennessee Valley Authority}
    \citet{Kline_Moretti_2014} look at the long-run impacts of the Tennessee Valley Authority (TVA).

    \begin{itemize}
        \item The TVA was a large-scale federal investment started in 1934 that focused on improving manufacturing economy.
        
        \item The program focused on electrification through dams and transportation canals in order to improve the manufacturing economy
        
        \item Hundreds of dollars spent anually per person
    \end{itemize}
\end{frame}

\begin{frame}{Identification}
    \citet{Kline_Moretti_2014} run the county-level difference-in-differences  specification: 
    \begin{equation}\label{eq:tva_spillover}
        y_{c, 2000} - y_{c, 1940} = \alpha + \text{TVA}_c \tau + X_{c, 1940} \beta + (\varepsilon_{c, 2000} - \varepsilon_{c, 1940})
    \end{equation} 

    \begin{itemize}
        \item $y$ are outcomes for agricultural employment, manufacturing employment, and median family income.
        \item $\text{TVA}_c$ is the treatment variable
        \item $X_{c, 1940}$ allow for different long-term trends based on covariates in 1940. 
    \end{itemize}

    They trim the sample using a logit regression to predict treatment using $X_{c,1940}$ and then keep control units in the top 75\% of predicted probability.
\end{frame}

\begin{frame}{Spillovers in the TVA Context}
    In our context, there is reason to believe spillovers can occur to nearby counties

    \begin{itemize}
        \item Agricultural employees might be drawn to hire wages for new manufacturing jobs in Tennessee Valley 
        
        \item Manufacturing jobs that would have been created in the control units in the absence of treatment might move to the Tennessee Valley
        
        \item Since manufacutring jobs pay higher than agricultural jobs, the above two spillover effects can cause changes in median family income
    \end{itemize}
\end{frame}

\begin{frame}{Specification including spillovers}
    \begin{equation}
        \Delta y_c = \alpha + \text{TVA}_i \tau + \sum_{d \in \text{Dist}} \text{Between}(d)\delta_d + X_{i, 1940} \beta + \Delta \varepsilon_c
    \end{equation} 

    \begin{itemize}
        \item $\text{Between}(d)$ is a set of indicators for being in the following distance bins (in miles) from the Tennessee Valley Authority: 
        \[ d \in \left\{ (0, 50], (50, 100], (100, 150] \right\} \]
    \end{itemize}
\end{frame}

\imageframe{../../figures/figure-tva-sample_slides.pdf}

\begin{frame}
\begin{table}[ht]
    \caption{Effects of Tennessee Valley Authority on Decadel Growth}
    \label{tab:tva}
    \renewcommand{\arraystretch}{1.2}

    \begin{adjustbox}{width = 1\textwidth, center}
        \begin{threeparttable}
            \begin{tabular}{@{} lc@{\extracolsep{20pt}}c@{\extracolsep{4pt}}ccc @{}}
                % Head
                \toprule

                & \multicolumn{1}{c}{\textbf{Diff-in-Diff}} & \multicolumn{4}{c}{\textbf{Diff-in-Diff with Spillovers}} \\ 
                \cmidrule{2-2} \cmidrule{3-6} 
                & & & TVA between & TVA between & TVA between \\ 
                \textit{Dependent Var.} & TVA & TVA & 0-50 mi. & 50-100 mi. & 100-150 mi. \\ 

                % Body
                \midrule
                
                Agricultural employment     & $-0.0514^{***}$& $-0.0678^{***}$& $-0.0310^{**}$ &    $-0.0112$   & $-0.0252^{***}$\\
                &   $(0.0087)$   &   $(0.0102)$   &   $(0.0123)$   &   $(0.0094)$   &   $(0.0084)$ 
                
                \onslide<2->{
                \\
                Manufacturing employment    & $0.0560^{***}$ &  $0.0461^{**}$ &    $-0.0104$   &    $-0.0128$   &  $-0.0248^{*}$ \\
                &   $(0.0187)$   &   $(0.0210)$   &   $(0.0205)$   &   $(0.0257)$   &   $(0.0147)$ 
                }
                \onslide<3->{
                \\
                Median family income        & $0.0191^{***}$ &  $0.0196^{**}$ &    $0.0056$    &    $-0.0062$   &    $-0.0011$   \\
                &   $(0.0067)$   &   $(0.0077)$   &   $(0.0079)$   &   $(0.0060)$   &   $(0.0032)$ 
                }
                \\
                
                % \input{../../tables/tva_replication_slides.tex}
                \bottomrule
            \end{tabular}
            
            % Notes 
            \begin{tablenotes}\footnotesize

                \item $^{*} p< 0.1$; $^{**} p < 0.05$; $^{***} p < 0.01$.
            \end{tablenotes}
        \end{threeparttable}
    \end{adjustbox}
\end{table}    

\end{frame}

\section{Conclusion}

\begin{frame}{To-do:}
    \begin{itemize}
        \item Include Monte-Carlo simulations on misspecification of spillovers
        
        \item Extend bias to settings with differential timing of treatment
    \end{itemize}
\end{frame}

\begin{frame}
    \begin{center}
        \Large \textbf{Thank you!}
    \end{center}
\end{frame}


























\end{document}
