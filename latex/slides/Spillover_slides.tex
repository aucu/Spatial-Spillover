\documentclass[aspectratio=43]{beamer}
% Metropolis Theme ---------------------------------
\usetheme{metropolis} % Use metropolis theme


% Title --------------------------------------------
\title{Differnces-in-Differences with Spatial Spillover}
\date{\today}
\author{Kyle Butts}
% \institue{}

\input{preamble.tex}

% ---------------------------------------------------
\begin{document}
\maketitle


\begin{frame}{Spatial Spillovers}
    Effects of treatments at states, counties, etc. can spill over boundaries.
        
    \begin{itemize}
        \item e.g. large employer opening/closing in a county have positive or negative employment effects on nearby counties
    \end{itemize}
    
    Differences-in-differences that compare outcomes among treated units with ``control'' units are biased from the spillover of effects.
\end{frame}

\begin{frame}{Research Question}
    What are the sources of bias when researchers do not account for sptial spillover of treatment effects? 
        
    \begin{itemize}
        \item In what contexts are these biases particularly large?
        
        \item Do current simple adjustments work?
    \end{itemize}
\end{frame}

\begin{frame}{Preview of Results}
    There are two sources of bias:
        \begin{itemize}
            \item[1.] Treatment effects spillover onto control units
            \item[2.] Treatment effects spillover onto also treated units
        \end{itemize}

    Solutions:
        \begin{itemize}
            \item Fixing bias 1 is relatively easy and works better when you have relatively few treated units
            
            \item Bias 2 worsens as treatment locations bunch more (spatial correlation of treatment increases)
            
            \item However, spatial correlation of treatment decreases bias 1
        \end{itemize}
\end{frame}

% Just TE
\imageframe{../../figures/figure-map_te.png}

% TE + Spill Control
\imageframe{../../figures/figure-map_te_spill_control.png}

% TE + Spill Control + Spill Treat
\imageframe{../../figures/figure-map_te_spill_all.png}


\begin{frame}{Potential Outcomes Framework}
    For exposition, I will label units as counties. Assume all treatment occurs at the same time (2-periods or pre-post averages).\footnote{This form adapts the framework of Vazquez-Bare (2020) for the diff-in-diff setting.}
    
    \begin{itemize}
        \item Let $Y_{it}(D_i, h_i(\vec{D}))$ be the potential outcome of county $i \in \{ 1, \dots, N \}$ at time $t$ with treatment status $D_i \in \{0, 1\}$.
        
        \item $\vec{D} \in \{0,1\}^N$ is the vector of all units treatments.
        
        \item The function $h_i(\vec{D})$ maps the entire treatment vector into a scalar that completely determines the spillover. 
        
        \item In the world with no treatment, $\vec{0}$, we say $h_i(\vec{0}) = 0$.
    \end{itemize}
\end{frame}

\begin{frame}{Examples of $h_i(\vec{D})$}
    
    Examples of $h_i(\vec{D})$:
    
    \begin{itemize}
        \item \textbf{Treatment within $x$ miles:}
        
        $h_i(\vec{D})$ = 1 if there is a treated unit within $x$-miles of unit $i$ and = 0 otherwise
            
        \item \textbf{Average treatment among k-nearest neighbors:}
        
        $h_i(\vec{D}) = \sum_{j = 1}^k D_{n(i,j)} / k$ where $n(i,j)$ represents the j-th closest neighbor to unit $i$. 


    \end{itemize}
\end{frame}

\begin{frame}{Estimand of Interest}
    Estimand of Interest: \[ 
        \textcolor{green}{\tau_{\text{direct}}} \equiv \textcolor{green}{\mathbb{E}\left[ Y_{i,1}(1, 0) - Y_{i,1}(0, 0) \mid D_i = 1\right]}
    \]

    This is the direct effect in the absense of spillovers.
\end{frame}

\begin{frame}{Parallel Trends}
    \begin{itemize}
        \item I assume a modified version of the parallel trends assumption: \[
            \mathbb{E}\left[ Y_{i,1}(0, 0) - Y_{i,0}(0, 0) \mid D_i = 1, \vec{D} = 0 \right] 
        \] \[
            \quad =
            \mathbb{E}\left[ Y_{i,1}(0, 0) - Y_{i,0}(0, 0) \mid D_i = 0, \vec{D} = 0 \right],
        \]

        \item In the complete absence of treatment (not just the absence of individual $i$'s treatment), the change in potential outcomes from period 0 to 1 would not depend on treatment status
    \end{itemize}
\end{frame}

\begin{frame}{What does Diff-in-Diff identify?}
    \begin{itemize}
        \item With that, I decompose the diff-in-diff estimate as follows: 
        
        \begin{align*}
            &\mathbb{E}_i \left[ Y_{i1} - Y_{i0} \mid D_i = 1 \right] - \mathbb{E}_i \left[ Y_{i1} - Y_{i0} \mid D_i = 0 \right] \\
            &\quad = 
            \textcolor{green}{\mathbb{E}_i \left[ Y_{i1}(1, 0) - Y_{i1}(0, 0) \mid D_i = 1 \right]} \\
            &\quad\quad + 
            \textcolor{red}{\mathbb{E}_i \left[ Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, 0) \mid D_i = 1 \right]} \\ 
            &\quad\quad - 
            \textcolor{purple}{\mathbb{E}_i \left[ Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, 0) \mid D_i = 0 \right]} \\
            &\quad \equiv \textcolor{green}{\tau_{\text{direct}}} + \textcolor{red}{\tau_{\text{spillover, treated}}} - \textcolor{purple}{\tau_{\text{spillover, control}}}
        \end{align*}

    \end{itemize}
\end{frame}

\begin{frame}{Signing the Bias}
    \[ 
        \textcolor{green}{\tau_{\text{direct}}} + \textcolor{red}{\tau_{\text{spillover, treated}}} - \textcolor{purple}{\tau_{\text{spillover, control}}}    
    \]

    \begin{table}
        \caption{Bias from Spillovers}
        \begin{tabular}{|l|cc|}
            \hline
            & + Spillover & - Spillover \\ \hline
            onto Treated & + Bias & - Bias \\
            onto Control & - Bias & + Bias \\
            \hline
        \end{tabular}
    \end{table}
\end{frame}

\begin{frame}{Example of Bias Simulation}
    \textbf{Treated Spillover:}
    
    $\mathbb{E}_i \left[ Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, 0) \mid D_i = 1 \right] = -0.5$ if county $i$ is within 40 miles of a treated county and $0$ otherwise.
        
    \textbf{Control Spillover:}
    
    $\mathbb{E}_i \left[ Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, 0) \mid D_i = 0 \right] = 1$ if county $i$ is within 40 miles of a treated county and $0$ otherwise.
        
    \begin{itemize}
        \item Then, the bias term is \begin{align*}
            -0.5 * \text{\% of treated within 40 miles of a treated county} \\
            -1 * \text{\% of control within 40 miles of a treated county}
        \end{align*}
    \end{itemize}
\end{frame}





\begin{frame}{Monte Carlo Simulations}
    \begin{itemize}
        \item Simulated the following Data Generating Process \begin{align*}
            y_{it} &= -2 + \mu_t + \mu_i + \tau_{\text{direct}} D_{it} + \tau_{\text{spillover, control}} (1-D_{it}) \text{Near}_{it} \\ 
            &\quad + \tau_{\text{spillover, treated}} D_{it} \text{Near}_{it} + \varepsilon_{it}
        \end{align*}

        \item Observation $i$ is a U.S. county, year $t \in \{2000, \dots, 2019\}$, treatment $D_{it}$ turns on in 2010 and is assigned randomly or through a spatial process.
        
        \item $\text{Near}_{it}$ is an indicator for having your county centroid be within 40 miles of a treated unit. 
        
        \item $\tau_{\text{direct}} = 2$, $\tau_{\text{spillover, control}} = 1$ and $\tau_{\text{spillover, treat}} = -0.5$.
    \end{itemize}
\end{frame}

\begin{frame}{Source of Bias 1: Control Units}
    Simulation 1: 
    
    \begin{itemize}
        \item The first simulation changes the probability of treatment, $D_{it}$.
        
        \item Assume, for now, there is only spillover on the control.
        
        \item Estimate the following equation: \[ 
            y_{it} = \alpha + \mu_t + \mu_i + \tau D_{it} + \epsilon_{it}    
        \]
        
        \item The bias of our estimate is \textit{Bias} $= \hat{\tau} - 2$
    \end{itemize}


    
\end{frame}

\imageframe{../../figures/figure-bias_from_prob_treat_slides.png}


\begin{frame}{Solution: Removing ``contaminated'' controls}
    A common solution to the problem of spillover is to restimate without neighboring control units and see what happens to the bias.

    This simulation assumes the correct ``contaminated'' control units, i.e. only control units with $h_i(\vec{D}) \neq 0$, which is not possible for researchers.
\end{frame}

\imageframe{../../figures/figure-bias_fix_slides.png}


\begin{frame}{Source of Bias 2: Treated Units}
    Simulation 2:

    \begin{itemize}
        \item I now add in the bias from spillover of treated units on to other treated units.
        
        \item This source of bias only occurs when treated units are located next to eachother, so the magnitude of bias depends on spatial autocorrelation of $D_{it}$. 
        
        \item Using a method from geosciences, I generate correlated ``fields'' across the US. 
        
        \item Then, for the counties in the top 10\% of values (hot spots in the field), I increase the probability of treatment. 
        
        \item The unconditional probability remains fixed at 10\%.
    \end{itemize}
\end{frame}

\imageframe{../../figures/figure-krig_slides.png}

\imageframe{../../figures/figure-spcorr_high_map_te_spill_all.png}

\imageframe{../../figures/figure-spcorr_low_map_te_spill_all}

\imageframe{../../figures/figure-bias_from_spatial_autocorr_slides.png}

\imageframe{../../figures/figure-bias_fix_spatial_autocorr_slides.png}


\begin{frame}{Spillovers as estimand of interest}
    Until now, we assumed our estimand of interest is $\textcolor{green}{\tau_{\text{direct}}}$.

    However, the two other spillover effects are of interest as well:
    \begin{itemize}
        \item $\textcolor{purple}{\tau_{\text{spillover, control}}}$: Do the benefits of a treated county come at a cost to neighbor counties? 
        
        \item $\textcolor{red}{\tau_{\text{spillover, treated}}}$: Does the estimated effect change based on others treatment? (This is what you should consider if you are a policy maker)
    \end{itemize}

    To estimate the spillover effects, we have to parameterize $h_i(\vec{D})$ function and the potential outcomes function $Y_i(D_i, h_i(\vec{D}))$.
\end{frame}



\begin{frame}{Next Steps}
    \begin{itemize}
        \item Monte Carlo: estimating spillovers and the problem of misspecification
        
        \item Application: replicate paper(s) with a consideration of spillovers (any ideas?)
    \end{itemize}
\end{frame}


























\end{document}
